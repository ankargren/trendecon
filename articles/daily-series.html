<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating long daily series • trendecon</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating long daily series">
<meta property="og:description" content="trendecon">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trendecon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/daily-series.html">Creating long daily series</a>
    </li>
    <li>
      <a href="../articles/intro.html">Introduction to trendecon</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/trendecon/trendecon/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="daily-series_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating long daily series</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/trendecon/trendecon/blob/master/vignettes/daily-series.Rmd"><code>vignettes/daily-series.Rmd</code></a></small>
      <div class="hidden name"><code>daily-series.Rmd</code></div>

    </div>

    
    
<p>Once the combination of useful keywords is selected we might want to use them as economic indicators in production and display them on <a href="https://www.trendecon.org/">trendecon.org</a>. This vignette describes the steps for adding new indicators to the production processes of “Trendecon”.</p>
<div id="directory-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#directory-structure" class="anchor"></a>Directory structure</h2>
<p>The names of production functions within the <code>trendecon</code> package start with <code>proc_</code>. They usually operate on the file system which means that calling these functions will write files to the local disk. The <code>proc_</code> functions will save files within two folders: <code>data</code> and <code>raw</code>, which are located under the working directory (<code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code>). <code>raw</code> folder holds all the data downloaded from Google, plus some transformations, such as seasonally adjusted or combined series. <code>data</code> folder, on the other hand, collects the final indicators - the data displayed on the website. If not present these folders will be created when calling <code>proc_keyword_init</code> for the first time.</p>
<p>Within these folders, every used <code>geo</code> location will have its own subfolder. Thus, in the end, if we used Swiss and Austrian indicators, we would end up with the following directory structure:</p>
<pre><code>│
├── data
│   ├── at
│   └── ch
│
└── raw
    ├── at
    └── ch</code></pre>
</div>
<div id="initial-download" class="section level2">
<h2 class="hasAnchor">
<a href="#initial-download" class="anchor"></a>Initial download</h2>
<p>To include a new series, each keyword must first be initiated. Our goal is to produce long daily time series, ideally ranging from 2006. However, Google does not provide daily or weekly data for such a long time period. Hence, we need to circumvent the problem by applying a moving window of daily and weekly queries over the whole time period. So be careful, as this causes a lot of queries to Google and might result in a temporary IP address ban.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/proc_keyword_init.html">proc_keyword_init</a></span>(<span class="st">"Rezession"</span>, <span class="st">"CH"</span>)</pre></body></html></div>
<p>After running the code above we will have the aggregated series at daily, weekly and monthly frequency, stored in the <code>raw</code> folder. In this example the following files: <code>raw/ch/Rezession_d.csv</code>, <code>raw/ch/Rezession_w.csv</code>, and <code>raw/ch/Rezession_m.csv</code> will be created.</p>
</div>
<div id="updating-trendecon-indicators" class="section level2">
<h2 class="hasAnchor">
<a href="#updating-trendecon-indicators" class="anchor"></a>Updating trendecon indicators</h2>
<p>Once all the keywords are initiated and the raw data is obtained we need to process it. <code>trendecon</code> includes a few functions that process a collection of keywords. These functions produce the final indicators that we show on <a href="https://www.trendecon.org/">trendecon.org</a>. These are called by an automated process which is set up on GitHub, so we do not need to call them manually when updating the data.</p>
<p>For example, in order to process all Swiss indicators of trendecon, run:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/proc_trendecon_ch.html">proc_trendecon_ch</a></span>()</pre></body></html></div>
<p>This function updates the series for each keyword, and produces the indicators. In the final step all the specified Swiss indicators will be processed and the final data is stored in the <code>data/ch</code> folder. The list of active Swiss indicators can be found within the code of <code><a href="../reference/proc_trendecon_ch.html">proc_trendecon_ch()</a></code> function.</p>
</div>
<div id="preprocessing-indicators-step-by-step" class="section level2">
<h2 class="hasAnchor">
<a href="#preprocessing-indicators-step-by-step" class="anchor"></a>Preprocessing indicators step by step</h2>
<p>While <code><a href="../reference/proc_trendecon_ch.html">proc_trendecon_ch()</a></code> automatically updates the indicators it cannot add new indicators to production. In order to be able to introduce new indicators it is insightful to walk through the different steps performed by <code><a href="../reference/proc_trendecon_ch.html">proc_trendecon_ch()</a></code>. The same steps will be required to build indicators from other sets of keywords or for other countries. The steps of such preparation are outlined below.</p>
<div id="step-1-update-with-latest-data" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1-update-with-latest-data" class="anchor"></a>Step 1: update with latest data</h3>
<p>In the first step, the raw data series for each keyword are updated with the latest daily, weekly, and monthly data. For example, to update the raw series for keyword <code>"Rezession"</code> for Switzerland, the script calls the following internal function:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/proc_keyword_latest.html">proc_keyword_latest</a></span>(<span class="st">"Rezession"</span>, <span class="st">"CH"</span>)</pre></body></html></div>
<p>This function downloads raw daily, weekly, and monthly data for the specified pair of keyword and geo location. If the data for a particular keyword is not yet available, <code><a href="../reference/proc_keyword_init.html">proc_keyword_init()</a></code> should be called instead.</p>
</div>
<div id="step-2-bending" class="section level3">
<h3 class="hasAnchor">
<a href="#step-2-bending" class="anchor"></a>Step 2: bending</h3>
<p>To combine the three frequencies (monthly, weekly, and daily), we apply the following methodology: in a first step, we “bend” the daily series to the weekly values, by applying a variant of the Chow-Lin (1971) method. This preserves the movement of the daily series and ensures that weekly averages are identical to the original weekly series. We then use the same methodology to bend the series to the monthly values.</p>
<p>To combine the three frequencies for a given keyword, the script calls another internal function:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu">proc_combine_freq</span>(<span class="st">"Rezession"</span>, <span class="st">"CH"</span>)</pre></body></html></div>
</div>
<div id="step-3-seasonal-adjustment" class="section level3">
<h3 class="hasAnchor">
<a href="#step-3-seasonal-adjustment" class="anchor"></a>Step 3: seasonal adjustment</h3>
<p>Some keywords’ time series might display seasonal patterns. For example it is not surprising that searches for gardening are higher in spring. In order to make meaningful comparisons over time such seasonal patterns, present within the data, need to be removed. To achieve this <code>trendecon</code> uses the “Prophet” procedure for estimating an additive model where non-linear trends are fit with yearly and weekly seasonality and the holiday effects.</p>
<p>To seasonally adjust a combined keyword, the script calls the following internal function:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu">proc_seas_adj</span>(<span class="st">"Rezession"</span>, <span class="st">"CH"</span>)</pre></body></html></div>
</div>
<div id="step-4-combining" class="section level3">
<h3 class="hasAnchor">
<a href="#step-4-combining" class="anchor"></a>Step 4: combining</h3>
<p>Once the raw data for each keyword has been processed we end up with multiple time series - one for each keyword within the indicator. As an example the main indicator uses the following keywords: <code>"Wirtschaftskrise"</code>, <code>"Kurzarbeit "</code>, <code>"arbeitslos"</code>, and <code>"Insolvenz"</code>. To turn several provided keywords into a single time series the first principal component is used.</p>
<p>In order to achieve this the script calls <code>ts_prcomp()</code> function from the <code>tsbox</code> package.</p>
</div>
<div id="step-5-writing-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#step-5-writing-the-data" class="anchor"></a>Step 5: writing the data</h3>
<p>Finally the prepared index is saved to a file in the data folder:</p>
<pre><code><a href="../reference/write_keyword.html">write_keyword(prepared_data, "indicator", "CH")</a></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Angelica Becerra, Nina Mühlebach, Christoph Sax, Sverin Thoeni, Uwe Thuemmel, Karolis Koncevičius.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
